(()=>{"use strict";const e={formSelector:".form",inputSelector:".form__item",submitButtonSelector:".button_type_save",inputInvalidClass:"form__item_type_error",buttonInvalidClass:"button_disabled"};class t{constructor(e,t){this._form=t,this._inputSelector=e.inputSelector,this._submitButtonSelector=e.submitButtonSelector,this._inputInvalidCLass=e.inputInvalidCLass,this._buttonInvalidClass=e.buttonInvalidClass,this._button=this._form.querySelector(this._submitButtonSelector),this._inputList=this._form.querySelectorAll(this._inputSelector)}_showError(e){this._form.querySelector(`#${e.id}-error`).textContent=e.validationMessage,e.classList.add(this._inputInvalidClass)}_hideError(e){this._form.querySelector(`#${e.id}-error`).textContent="",e.classList.remove(this._inputInvalidClass)}_checkInputValidity(e){e.validity.valid?this._hideError(e):this._showError(e)}_setButtonState(e){e?(this._button.classList.remove(this._buttonInvalidClass),this._button.disabled=!1):(this._button.classList.add(this._buttonInvalidClass),this._button.disabled=!0)}_setEventListeners(){this._inputList.forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(e),this._setButtonState(this._form.checkValidity())}))}))}enableValidation(){this._setEventListeners(),this._form.addEventListener("submit",(e=>{e.preventDefault(),this._setButtonState(this._form.checkValidity())}))}}class s{constructor({data:e,handleCardClick:t},s){this._title=e.name,this._link=e.link,this._name=e.name,this._cardSelector=s,this._handleCardClick=t}_getTemplate(){return document.querySelector(this._cardSelector).content.cloneNode(!0)}generateCard(){return this._element=this._getTemplate(),this._setEventListeners(),this._element.querySelector(".gallery__item-title").textContent=this._name,this._element.querySelector(".gallery__item-image").src=this._link,this._element.querySelector(".gallery__item-image").alt=this._name,this._element}_setEventListeners(){this._element.querySelector(".button_type_like").addEventListener("click",(e=>{e.target.classList.toggle("button_clicked")})),this._element.querySelector(".button_type_delete").addEventListener("click",(e=>{e.target.closest(".gallery__item").remove()})),this._element.querySelector(".gallery__item-image").addEventListener("click",(()=>this._handleCardClick()))}}class i{constructor(e){this._popup=document.querySelector(e)}open(){this._popup.classList.add("popup_opened")}close(){this._popup.classList.remove("popup_opened")}setEventListeners(){document.addEventListener("click",this._handleOverlayClose.bind(this)),document.addEventListener("keydown",this._handleEscClose.bind(this)),this._popup.querySelector(".button_type_close").addEventListener("click",this._handleButtonClose.bind(this))}removeEventListeners(){document.removeEventListener("click",this._handleOverlayClose.bind(this)),document.removeEventListener("keydown",this._handleEscClose.bind(this)),this._popup.querySelector(".button_type_close").removeEventListener("click",this._handleButtonClose.bind(this))}_handleButtonClose(){this.close()}_handleEscClose(e){"Escape"===e.key&&this.close()}_handleOverlayClose(e){e.target.classList.contains("popup_opened")&&this.close()}}class n extends i{constructor(e,t){super(e),this._formSubmitCallback=t,this._form=this._popup.querySelector(".form"),this._submitForm=this._submitForm.bind(this),this.close=this.close.bind(this)}_getInputValues(){return this._inputList=this._form.querySelectorAll(".form__item"),this._formValues={},this._inputList.forEach((e=>{this._formValues[e.name]=e.value})),this._formValues}setEventListeners(){this._form.addEventListener("submit",this._submitForm),super.setEventListeners()}_submitForm(e){e.preventDefault(),this._formSubmitCallback(this._getInputValues())}close(){this._form.reset(),this._form.removeEventListener("submit",this._submitForm),super.close()}}const r=document.querySelector(".button_type_edit"),o=document.querySelector(".button_type_add"),l=document.querySelector(".form__item_type_name"),a=document.querySelector(".form__item_type_job"),_=document.querySelector(".form_type_edit"),c=document.querySelector(".form_type_add");new t(e,_).enableValidation(),new t(e,c).enableValidation();const d=new class extends i{constructor(e,t,s){super(s),this._imageTitle=this._popup.querySelector(e),this._imageLink=this._popup.querySelector(t)}open(e,t){this._imageTitle.textContent=e,this._imageLink.src=t,this._imageLink.alt=e,super.open()}}(".popup__image-title",".popup__image",".popup_type_image");d.setEventListeners();const u=new class{constructor({items:e,renderer:t},s){this._initialCards=e,this._renderer=t,this._container=document.querySelector(s)}renderList(){this._initialCards.forEach((e=>this._renderer(e)))}addItem(e){this._container.append(e)}addNewItem(e){this._container.prepend(e)}}({items:[{name:"Архыз",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/arkhyz.jpg"},{name:"Челябинская область",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/chelyabinsk-oblast.jpg"},{name:"Иваново",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/ivanovo.jpg"},{name:"Камчатка",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/kamchatka.jpg"},{name:"Холмогорский район",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/kholmogorsky-rayon.jpg"},{name:"Байкал",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/baikal.jpg"}],renderer:e=>{const t=new s({data:e,handleCardClick:()=>{d.open(e.name,e.link)}},".template").generateCard();u.addItem(t)}},".gallery__list");u.renderList();const h=new n(".popup_type_add",(e=>{const t=new s({data:e,handleCardClick:()=>{d.open(e.name,e.link)}},".template").generateCard();u.addNewItem(t),h.close(),h.removeEventListeners()}));o.addEventListener("click",(()=>{h.open(),h.setEventListeners()}));const m=new class{constructor(e,t){this._nameProfile=document.querySelector(e),this._jobProfile=document.querySelector(t)}getUserInfo(){return{name:this._nameProfile.textContent,job:this._jobProfile.textContent}}setUserInfo(e,t){this._nameProfile.textContent=e,this._jobProfile.textContent=t}}(".profile__name",".profile__job"),p=new n(".popup_type_edit",(e=>{m.setUserInfo(e.name,e.job),p.setEventListeners(),p.removeEventListeners()}));r.addEventListener("click",(()=>{p.open(),p.setEventListeners();const e=m.getUserInfo();l.setAttribute("value",e.name),a.setAttribute("value",e.job)}))})();